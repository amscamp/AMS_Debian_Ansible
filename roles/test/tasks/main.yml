---


- name: Gather the package facts
  ansible.builtin.package_facts:
    manager: auto

# - name: Filter package names
#   set_fact:
#     filtered_package_names: "{{ ansible_facts.packages | list 
#       | map('regex_search', '^master-pdf-editor.*') | select('string') | list }}"




- ansible.builtin.set_fact:
    master_pdf_editor: "{{ ansible_facts.packages[item] }}"
  loop: "{{ ansible_facts.packages.keys() | select('match', '^master-pdf-editor.*') | list }}"

# - debug:
#      var: ansible_facts


# - name: Dump
#   copy:
#     content: "{{ hostvars[inventory_hostname] | to_nice_json }}"
#     dest: /tmp/setup-dump.json

- name: Check whether a package called foobar is installed
  ansible.builtin.debug:
    msg: "{{ hostvars[inventory_hostname].master_pdf_editor[0].version }} of mpe is installed!"
  when: hostvars[inventory_hostname].master_pdf_editor is defined

- name: Check whether a package called foobar is installed
  ansible.builtin.debug:
    msg: "mpe is not installed!"
  when: hostvars[inventory_hostname].master_pdf_editor is not defined

# - name: determinate free-pdf-editor link
#   shell: echo "https://code-industry.net/public/$(curl -s https://code-industry.net/free-pdf-editor/ | grep -o 'master-pdf-editor-[0-9]*\.[0-9]*\.[0-9]*\-qt5.x86_64.deb' | head -1)"
#   register: tempurl

# - name: Install free-pdf-editor
#   apt: deb={{ tempurl.stdout }}


